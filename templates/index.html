<!-- HTML document that creates a user interface for a T.A.U.I. It includes styling for input boxes, buttons,
and headings, as well as a script that utilizes the Google Maps API for autocomplete functionality and
geolocation. Also includes a form for users to input their start and end addresses, and if those
addresses are provided, it displays directions, links to call an Uber, and a static map of the route. -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Are you here?</title>
    <style>
        *{
           font-family: "Lucida Console", "Arial", sans-serif;
       }
       html, label, .click-button, .input-box{
           background-color: #43136c;
           color: #b478e7;
       }
       .click-button, .input-box{
           border: 0.75vh solid #b478e7;
           border-radius: 0.75vh;
       }
       .input-box, .click-button {
           width: 100%;
           box-sizing: border-box;
       }
       input[type="text"], .click-button{
           padding: 0.25vh;
       }
       input, .click-button, .input-box{
           font-size: 5vh;
           margin-bottom: 0.5vh;
           margin-top: 0;
       }
       h1, label {
           font-size: 3.75vh;
           margin-bottom: 0.5vh;
           margin-top: 0;
       }
       #title {
           font-size: 12vh;
           margin-top: 0;
           margin-bottom: 2.5vh;
       }
       iframe {
           width: 100%;
           height: 41vh;
           box-sizing: border-box;
       }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&libraries=places"></script>
    <script>
        function initAutocomplete() {
            var startInput = document.getElementById('start-input');
            var endInput = document.getElementById('end-input');

            var startAutocomplete = new google.maps.places.Autocomplete(startInput);
            var endAutocomplete = new google.maps.places.Autocomplete(endInput);
            }
        google.maps.event.addDomListener(window, 'load', initAutocomplete);

        function getUserLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;

                    // Create a JSON object with the input data
                    var locationData = {
                        latitude: latitude,
                        longitude: longitude
                    };
                    console.log(latitude, longitude)

                    // Convert locationData to a query string
                    console.log(Math.abs(latitude-41.982) < 0.001);
                    console.log(Math.abs(longitude+87.708) < 0.001);
                    if ((Math.abs(latitude-41.982) < 0.001) && (Math.abs(longitude+87.708) < 0.001)) {
                        document.getElementById("check-button").innerHTML = "You're here! Fill out the form below";
                        document.getElementById("check-button").style.color = "#3fef39";
                        document.getElementById("check-button").style.borderColor = "#3fef39";
                        document.getElementById("check-button").style.backgroundColor = "#084705";
                    } else {
                        document.getElementById("check-button").innerHTML = "You aren't here! Email atdanakis@cps.edu if this is in error";
                        document.getElementById("check-button").style.color = "#ff0000";
                        document.getElementById("check-button").style.borderColor = "#ff0000";
                        document.getElementById("check-button").style.backgroundColor = "#660000";
                    }

                    // Send the JavaScript variable to the Flask server using a GET request
                    fetch('/receive_location_data?' + queryString)
                        .then(response => response.text())
                        .then(data => {
                             // Update the HTML content with the received data
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                }, function (error) {
                    if (error.code === error.PERMISSION_DENIED) {
                        alert("Location access denied. To enable, go to your browser settings.");
                    } else if (error.code === error.POSITION_UNAVAILABLE) {
                        alert("Location information is unavailable.");
                    } else if (error.code === error.TIMEOUT) {
                        alert("The request to get user location timed out.");
                    } else {
                        alert("An unknown error occurred.");
                    }
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }
    </script>
</head>
<body>
    <h1 id = title>Are you here?</h1>
    <button id = "check-button" class = click-button onclick="getUserLocation()">Check Location</button>
    <form method="POST">
        <label for="start-input">Start Address:</label>
        <br>
        <input id="start-input" type="text" name="start" class="input-box" value="{{ start }}">
        <br>
        <label for="end-input">End Address:</label>
        <br>
        <input id="end-input" type="text" name="end" class="input-box" value="{{ end }}">
        <br>
        <input class ="click-button" type="submit" value="Get Directions">
    </form>
    {% if start and end %}
       <h1 id = "route-label"></h1>
       <div class="carousel-container">
           <div id="iframe-carousel">
               <iframe
                   class="carousel-iframe"
                   style="border:0"
                   loading="lazy"
                   allowfullscreen
                   src="https://www.google.com/maps/embed/v1/directions?key={{ api_key }}
                   &origin={{ start }}
                   &destination={{ stop1_lat }},{{ stop1_long }}
                   &mode=driving">
               </iframe>
               <iframe
                   class="carousel-iframe"
                   style="border:0"
                   loading="lazy"
                   allowfullscreen
                   src="https://www.google.com/maps/embed/v1/directions?key={{ api_key }}
                   &origin={{ stop1_lat }},{{ stop1_long }}
                   &destination={{ stop2_lat }},{{ stop2_long }}
                   &mode=transit">
               </iframe>
               <iframe
                   class="carousel-iframe"
                   style="border:0"
                   loading="lazy"
                   allowfullscreen
                   src="https://www.google.com/maps/embed/v1/directions?key={{ api_key }}
                   &origin={{ stop2_lat }},{{ stop2_long }}
                   &destination={{ end }}
                   &mode=driving">
               </iframe>
           </div>
           <div class="carousel-navigation">
               <button class="carousel-button" id="prev-button">&lt</button>
               <button class="carousel-button" id="next-button">&gt</button>
           </div>
       </div>
        <div class="button-container">
            <div id="double-deeplink-button">
               <button class="half-click-button" id="double-uber-button">Call an Uber</button>
               <button class="half-click-button" id="double-google-button">Open in Google</button>
            </div>
            <button class="click-button" id="deeplink-button" onclick =
                    "window.open(uberUrls[currentIframeIndex], '_blank')"
            >Open in Google</button>
       </div>
    {% endif %}
</body>
</html>
