<!-- HTML document that creates a user interface for a T.A.U.I. It includes styling for input boxes, buttons,
and headings, as well as a script that utilizes the Google Maps API for autocomplete functionality and
geolocation. Also includes a form for users to input their start and end addresses, and if those
addresses are provided, it displays directions, links to call an Uber, and a static map of the route. -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Are you here?</title>
    <style>
        *{
           font-family: "Lucida Console", "Arial", sans-serif;
        }
        html, label, .click-button, .input-box{
            background-color: #43136c;
            color: #b478e7;
        }
        .click-button, .input-box{
            border: 0.75vh solid #b478e7;
            border-radius: 0.75vh;
        }
        .input-box, .click-button {
            width: 100%;
            box-sizing: border-box;
        }
        input[type="text"], .click-button{
            padding: 0.25vh;
        }
        input, .click-button, .input-box{
            font-size: 5vh;
            margin-bottom: 0.5vh;
            margin-top: 0;
        }
        h1, label {
            font-size: 3.75vh;
            margin-bottom: 0.5vh;
            margin-top: 0;
        }
        #title {
            font-size: 12vh;
            margin-top: 0;
            margin-bottom: 2.5vh;
        }
        iframe {
            width: 100%;
            height: 41vh;
            box-sizing: border-box;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&libraries=places"></script>
    <script>
        function getUserLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;

                    // Create a JSON object with the input data
                    var locationData = {
                        latitude: latitude,
                        longitude: longitude
                    };
                    console.log(latitude, longitude)

                    // Convert locationData to a query string
                    console.log(Math.abs(latitude-41.982) < 0.001);
                    console.log(Math.abs(longitude+87.708) < 0.001);
                    if ((Math.abs(latitude-41.982) < 0.001) && (Math.abs(longitude+87.708) < 0.001)) {
                        document.getElementById("check-button").innerHTML = "You're here! Fill out the form below";
                        document.getElementById("check-button").style.color = "#3fef39";
                        document.getElementById("check-button").style.borderColor = "#3fef39";
                        document.getElementById("check-button").style.backgroundColor = "#084705";
                        displayGoogleSignInButton();
                    } else {
                        document.getElementById("check-button").innerHTML = "You aren't here! Email atdanakis@cps.edu if this is in error";
                        document.getElementById("check-button").style.color = "#ff0000";
                        document.getElementById("check-button").style.borderColor = "#ff0000";
                        document.getElementById("check-button").style.backgroundColor = "#660000";
                    }
                }, function (error) {
                    if (error.code === error.PERMISSION_DENIED) {
                        alert("Location access denied. To enable, go to your browser settings.");
                    } else if (error.code === error.POSITION_UNAVAILABLE) {
                        alert("Location information is unavailable.");
                    } else if (error.code === error.TIMEOUT) {
                        alert("The request to get user location timed out.");
                    } else {
                        alert("An unknown error occurred.");
                    }
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }
    </script>
</head>
<body>
    <h1 id = title>Are you here?</h1>
    <button id = "check-button" class = click-button onclick="getUserLocation()">Check Location</button>

    <video id="webcam" autoplay playsinline width="640" height="480"></video>
    <button id="capture-button" class="click-button" onclick="captureImage()">Capture Photo</button>

    <!-- Hidden canvas for capturing the image -->
    <canvas id="canvas" width="640" height="480" style="display: none;"></canvas>

    <script>
        let video = document.getElementById('webcam');
        let canvas = document.getElementById('canvas');
        let context = canvas.getContext('2d');

        // Request access to the webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(err => {
                console.error("Error accessing the camera", err);
            });

        // Capture the current image in the webcam feed
        function captureImage() {
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            let image_data_url = canvas.toDataURL('image/jpeg');

            // Here, you can save the image_data_url to a server, display it, etc.
            console.log(image_data_url);  // Or do something with the image
        }
    </script>
</body>
</html>
